<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">

<dom-module id=my-character>
  <template>
    <style>
      :host {
        display: block;
        /*opacity: 0;*/
        position: absolute;
        top: 40px;
        z-index: 2;
        opacity: 0;
        background-color: transparent;
        background-position: 50% 50%;
        background-repeat: no-repeat;
        background-size: contain;
      }

      img {
        width: 100%;
      }

      svg,
      iron-pages {
        position: absolute;
        z-index: 1;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /*opacity: 0;*/
      }
      svg {
        width: 101%;
        height: 101%;
        left: -2px;
        top: -1px;
      }
      picture {
        position: relative;
        z-index: 2;
      }

      :host([page="working"]) {
        left: calc(var(--app-mobile-side-margin) * -1);
      }

      :host([page="writing"]) {
        left: -15px;
      }

      :host([page="speaking"]) {
        left: -15px;
      }

      @media screen and (min-width: 414px) {
        :host([page="working"]) {
          left: -12px;
        }

        :host([page="writing"]) {
          left: 0;
        }

        :host([page="speaking"]) {
          left: 0;
        }
      }

      @media screen and (min-width: 500px) {
        :host {
          top: 20px;
        }

        :host([page="working"]) {
          width: 250px;
        }

        :host([page="writing"]) {
          width: 210px;
        }

        :host([page="speaking"]) {
          width: 180px;
        }
      }

      @media screen and (min-width: 600px) {
        :host([page="working"]) {
          width: 260px;
        }

        :host([page="writing"]) {
          width: 230px;
        }

        :host([page="speaking"]) {
          width: 220px;
        }
      }

      @media screen and (min-width: 768px) {
        :host {
          top: 75px;
        }

        :host([page="working"]),
        :host([page="writing"]),
        :host([page="speaking"]) {
          width: auto;
          /*top: 75px;*/
          left: -58px;
        }
        :host([page="writing"]) {
          left: 0;
        }
      }

      @media screen and (min-width: 900px) {
        :host([page="speaking"]) {
          left: 0;
        }
        :host([page="working"]) {
          left: -18px;
        }
      }

      @media screen and (min-width: 1024px) {
        :host([page="working"]) {
          left: -73px;
        }
      }
    </style>

    <iron-pages selected="[[selectedPage]]">
      <svg id="speaking-contour" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1496 1522"><g fill="none" fill-rule="evenodd" stroke="#FFF" stroke-width="12" stroke-linecap="round" stroke-linejoin="round"><path d="M781 1015c-3.3-6-12.7-7.7-28-5-23 4-77 12-107 29-11.7 6.6-37 3-56 0s-39-22-37-29c21.4-75 1-92-7-100-4-4-17.5-1-17 4 5 54-12 74-17 84s-27 18-36 54c-64.5 20.5-167 32-213 25s-72-31.7-94-38c-14.7-4.2-35.7-6.5-63-7m140-253c6.3 47.5 7.6 89.5 4 126-10 25-16 69.3-25 87-37-29-64-50-97-56-22-4-53.3-.7-94 10m189 45c-14 25.3-26.7 43.7-38 55m165-523c-117.3 52-181 81.3-191 88-15 10-30 30-40 55s-16.2 33.8-27 70c-3 10-16 59-71 193-3.3 11-8 32 12 17m387-588c-39.3 20-38 30 4 30 18 0 35-.7 51-2 3.3 11.3 37.3 18.3 102 21 1.7 9 4 14.4 7 16 4.4 2.4 19 3 23 0s8-20.6 5-24c-3-3.4-19-4.2-26-3-4.6.8-7 3-7 7m55 144c64 44 59 38 92 45s53 19 74 45 64 171 71 206 11 78 19 105c-20 18-51.7 28.3-95 31"/><path d="M647 521c-4.7 11.3-11 18.3-19 21l6 5c17.3 68.7-2 104.3-58 107-84 4-100-48-136-74-36-38-62-41-89-57 56-19 77-93 75-109m435 604c69-70 101-127 109-160 1.7-6.8-7-37 0-55-5-4-7-2.5-8-8-1-5 1-20 0-24-3-13-10-22.3-13-31-2-6 3-13.4 10-21 0-23 14-20 21-15 4.7 3.3 8 12.7 10 28 2.4 6.6 5 9.6 8 9 9-2 19.5-5.8 20-9 2-13 19-24 30-37 23-67 28-75 55-107 13.3-15.8 27.8-.8 24 10-11 31-27 51.3-35 92-1.5 7.8 13.4 13.4 19 7 25-29 42-54.2 75-82 19-16 30 4 21 17-25 36-38.7 41.3-70 86-3.7 5.3 0 12.6 4 9 33-30 51.6-51.3 72-66 25-18 33 11 23 23-12.3 14.7-18 15-32 33s-31 29.4-53 54c-2.4 2.7-1.2 8.3 2 8 35-3 43-4 75-9 12.2-2 14 13 4 17-22.3 9-49.7 18.3-82 28-6 8-12 13.7-18 17 0 15-39 45-53 55-21.8 38.2-39.2 82-52 131M24 965c-23 35-26 236 0 232s38.4-10.4 83 0c192 45 319-6 364-25 47.3 7.3 97.7 0 151-22"/><path d="M503 1499c4.7-106 10-186 16-240 69-67 149-163 220-239 2.8-3 150.8-3 444 0m-444 10l-18 466M486 273c-.6 21 1 32.6 5 35 3 2 8.4-5.4 16-22 1 14 3 19.3 6 16 7-69 50-78 58-85-12-4-35.2 7.6-37 0-2.2-9 21.3-19.6 29-33 1.8-3-12.7 5.5-13 0-1.7-29.5-3-50 9-70 5-8 12 9.3 25 14 6.4 2.3 7 1 14 0 146 89 168-4 169-23-4 5-6.3 18.6-8 15-2.2-4.6-2.2-15.6 0-33-1.8 8.7-4.2 11.7-7 9-11-47-51-73-62-72-15.2 1.4-17 11-35 9-60-7-75-3-108 8-5.5 1 17.2 5.7 12 7-52-11-68 0-94 15-55 11-68 46-75 65-3.7 2.6-6.4-12.6-6-8-2 85.3 7.7 161 29 227 4-9.6 6.4-13 7-10 3 16.4 4.4 39 4 68 20-6.2 35-15 45-26-1-10 5-21.4-4-19-22 6-34-20-45-36s-20-51-3-63c11.3-8 30.7-6.3 58 5"/><path d="M519 443c37 75 158 82 183 78 16.7-2.7 24.3-11 23-25l3-41c14.7-24.7 22-72.3 22-143 0-21 13.2-19.2 12-36-2.8-38-10.5-75.5-23-112m82 584c0 82-13 124-19 140s1 52-29 80c-10 9.3-10 13.7 0 13l-2 28m119-59s5 17 10 24m-673 241c-45 69-13 75 2 82-11.3 9.3-17 32.3-17 69l8.5-6-6.5 25 6.5-2c-4.3 16-5.2 25.7-2.5 29 68 33 85 52 118 63 22 7.3 78 12.7 168 16"/></g></svg>
      <svg id="writing-contour" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1411 1414"><g fill="none" fill-rule="evenodd" stroke="#FFF" stroke-width="12" stroke-linecap="round" stroke-linejoin="round"><path d="M220.8 280c-32.92 29.7-42.5 71.58-28.67 125.74-19.76 69.3 27.08 104.36 58.3 135.64 4.94 4.95 33.6 21.78 81.03 62.38 6.92 0-19.76-36.63-45.46-131.68-4.94 1-12.84 12.87-15.8 9.9-3.27-23.07-4.95-48.22-4.95-75.25-12.84 5.94-18.47 5.55-16.8-1 6.63-25.73 23.03-48.5 49.4-68.3m-39.5 214.84c-13.16 1.98-17.8 9.9-13.85 23.77 5.93 20.8 47.24 46.83 63.24 72.27 11.86 18.9 39.13-.9 40.32-19.8 23.22 29.7 58.3 59.2 104.94 88.2m-150.2-66.4c-20.75 3-35.27 7.3-43.48 12.9-2.27 1.6 1.68 4.6 11.86 8.9-23.02 1.3-39.82 13.2-50.4 35.7 88.94-31 141 31.4 156.13 187.1-9.8-3.9-15.1-5.2-15.8-3.9 18.5 62.7 20.1 125.5 5 188.1"/><path d="M221.36 711.27c-24.46 27.77-44.57 61.5-60.42 101.2-1.98 4.95 2.58 6.34 13.87 3.96L155 836.27c-12.58 43.65-17.83 84.62-15.85 123.02-53.48 42.6-37.64 142.8-34.66 168.6 109.6-145.5 195.1-184.5 256.5-117m291.2-434.6c24.4 3.9 44.2 12.2 59.4 24.8 27.7-20.9 57.4-29.8 88.1-24.8 10.6 1.7 17.1 11.9 38.6 16.8 21.8-1 54.5 2 67.4 7.9 7.5 3.45 5.9 14.86 8.9 31.73 41.6 28.5 69.3 58.34 83.2 89.6l10.9 2.67 92.1 144.8c-48.8-22.8-83.2-31.44-103-25.8-9.2 2.7-15.6 10.23-18.9 22.83m-611.1 394.9l30.7-15.9L792.7 1350c113.2-17.64 218.5-36.1 316-55.53 2-54.6 53.5-36.7 61.4-19.87l222.85-72.4 10.9 3c-64.7 30.5-148.88 62.5-252.58 96.25-158.1 26.8-269.4 37.7-368.5 70.46-56.78-33.02-195.15-69.72-415-110.1z"/><path d="M109 1124.74c3.96 36.6 1 79.35 14.83 94 34.6 36.6 224.47 92.02 328.3 61.34m646.7-406.67c56.67 78.5 94.64 133.6 113.72 165.3 19.1 31.7 27 75.9 23.74 132.6M286 1083.2c114-10.6 186.9-8.9 218.5 4.95 47.47 20.78 62.3 30.67 136.47 32.65 49.43 1.3 158.2 8.9 326.3 22.75M498.63 818c52.7 58.68 99.17 130.9 139.4 216.7M475.87 838.77c26.4 54.12 42.82 124.38 49.44 210.76M627.3 637c9.2-19.7 17.83-51.92 25.76-96.54-15.15-59.1-34.67-103.15-58.45-132-13.5-31.54-8.9-33.5-25.7-64.05-22.8-49.2-24.8-63-48.5-96.5-1.8-2.9-3.7.5-5.9 9.9-7.94-36.1-42.6-69.2-104.04-99.5-3.37-2.7-1 2.8 6.93 16.8-68.07-17.7-116.23-22.3-144.66-13.8-17.1 13.8-32 41.1-44.6 81.8-.93 1.7-2.7.4-4.9-3.9 3.3 52.5 22.1 79.8 56.5 81.8 51.5 3 102.06-1 152.6-44.3 4.44-1.6-1.2-2.2-16.86-2L464 241.2c20.5 16.5 44.87 39.7 73.3 70"/><path d="M402.5 1245.17c-2-9.1-2-16.94 0-23.5 134.97-13.02 329.77-4.9 416.92-16.64 41.3-5.58 101.02-20.56 179.26-45.03 170.34 13.02 296.1 14.98 377.32 5.87-72.6 20.86-157.17 49.93-253.53 87.13-129.44-13.02-225.8-27.12-289.18-42.1"/><path d="M417.88 1232.66L797.6 1317c132.52-9.23 231.4-27.1 296.67-53.58m278.86-92.28l11.87 36.7m-844.5-405.8c-3.96 5.94-7.22 8.62-9.9 7.93-29.36-7.35-45.08-14.5-59.32-28.78-1.98-2-1.68-9.3 1-21.9-14.55-8-18.1-19.2-10.9-33.8-4.34-18.3-6.9-25.8-5.92-36.7.4-4.7 5.33-9.9 14.83-15.9-4-8-5.4-15.5-4-22.9 1-4.56 4.5-8.9 10.9-12.9l-48.5-54.57L407 548l32.63 23.8 52.4 56.57c17.12-5.26 30.97-7.64 41.55-6.94 16.8-10.92 43.5-18.56 48.45-12.9 6.92 7.94 66.26 88.3 144.38 143.88 16.9 11.9 238.4 121.1 418.3 213.4"/><path d="M516 780.6c4.95-12.8 57.4 23.65 113.8 64.05 8.9 6.4 35.62-.2 59.37 7.88 37.6 12.8 92.03 59.12 131.6 111.34C860.37 1016.1 886.1 1075.2 989 1156"/></g></svg>
      <svg id="working-contour" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1519 1386"><g fill="none" fill-rule="evenodd" stroke="#FFF" stroke-linecap="round" stroke-linejoin="round"><path stroke-width="12" d="M371.9 589.6c-75 5.2-120 15-136 30-49 1.2-63 19.5-72 32.3-30 7-53 24-70 51 11 0 17 1 17 2-17 12-24 43-21 93-4 17-6 29-5 35 1 9 5 11 10 21 6 131 12 82 31 99 6 46 5 58 26 72 2 5 4 11 7 16 4-3 6-3 7-1 24 37 34 76 41 120 16 55 100 75 149 73 49-3 159-71 228-133"/><path stroke-width="12" d="M251.5 347.7c-75.3 57.3-137.3 117-186 179 9.7 20 67.5 84.2 107.2 114"/><path stroke-width="4" d="M183.7 628L82.5 526.7c65.3-71.3 126-128.5 181.7-171.5 4-3 25 19.7 63.2 67.8"/><path stroke-width="12" d="M672 577c47.3 12 51.3 23.6 82.5 59 7.5 8.6 16.5 4.6 23.2 13 6.8 8.5 5 20.4 10.5 28.2 5.6 7.7 8.3 2.2 15.8 8.6 7.6 6.4 1.7 19 7.6 28.4 5.8 9.5 38 11.7 36.2 36 14 19.7 28.4 47.3 43.4 82.5m-23.3 460.2c-38-15-142-86-310-211l123-41M423.4 545c33.3 52.6 60 84.4 79.6 95.4 29.5 16.4 42.8 19.3 75.8 28.5 14 3 42.4-8 54.7-17 5.5-4 27.3-69 44.4-113 3-9-3-89 0-144 0-11 9-14 9-30 0-48-43-237-211-203-142 31-164 170-144 235-10 20-4 37 2 55 3 12 11 20 23 26-1 7 0 13 1 18s3 9 7 13l6 77c2 24 5 41 10 50 48 91 119 117 191 86"/><path stroke-width="12" d="M327 413c60.7-5.3 125.1 12.5 165.4 37.6 17 10.5 56 66.3 138.6 12l4 11.6c23 1.4 37.3 1.4 43.2.3m-184.8-24s10.5-52 35-81.4M329 318c145.3-85 280.3-90.7 333-51m25.2 105.2c-47.5-27-337.2 18-358.2 32.8m-25.4 652.3c47.8-38.3 92.2-36.2 135-50 169.4-54 197.7-94.3 260.4-111 62.8-16.5 78.2-24 105.2-25.2 18-1 46 9 84 29l-.3 44m-266 113l22-27m-297-56l20 50m247-4c54 21 85 22 92 25 7 4 41 57 79 94 15 15 42-8 30-24-27-34-40-50-69-89-5-6 6-17 12-13 44 37 53 50 108 93"/><path stroke-width="12" d="M881.4 1294c124-63.2 489.6-209.6 518.7-232.2 16-12 30-408 40-438.2 8-23.8-296 78-401 92.4-105 14.2-150 18.4-149 28 9 60.5-17 495.4-23 517-6 21.7 6 37.6 15 33h-.7zm-688-625.5c40.2 9.8 70 49 89.4 117.6 3.4 12-10.4 11-7.4 18 6.5 6 22 23 29.4 39 5 11-8.5 8-8.5 17s2.7 18 8.2 26c22 6 34.4 14 37.4 26s-3 23-16 32c14 14 22 24 24 31-69-4-128 16-177 59m504-296c34 41 51 91 52 152 10-3 26-7 42-11 29-54 58-85 86-94M680.4 532.5c2-5.6 5.5-8.5 10-9L717 494c2.4 1.5 4 1 5 0-5.5-65.8 44-70 72.7-89.8-20.3 44 8.6 86.7-64.8 97-1 1.7-1 3.6 0 6l-24 31.2c-1 13.4-7 27-21 41"/></g></svg>
    </iron-pages>

    <picture>
      <source media="(max-width: 599px)"
              srcset="/images/[[page]]-mobile.png,
                        /images/[[page]]-mobile@2x.png 1.5x,
                        /images/[[page]]-mobile@2x.png 2x">
      <source media="(max-width: 1023px)"
              srcset="/images/[[page]]-tablet.png,
                        /images/[[page]]-tablet@2x.png 1.5x,
                        /images/[[page]]-tablet@2x.png 2x">
      <source srcset="/images/[[page]].png,
                        /images/[[page]]@2x.png 1.5x,
                        /images/[[page]]@2x.png 2x">
      <img src="/images/[[page]].png" alt="" on-load="_notifyLoad">
    </picture>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class MyCharacter extends Polymer.Element {
      static get is() {
        return 'my-character';
      }

      static get properties() {
        return {
          page: {
            type: String,
            reflectToAttribute: true,
//            observer: 'animateCharacter'
          },
          timeline: Object,
          selectedPage: Number
        };
      }

      _notifyLoad() {
        this.dispatchEvent(new CustomEvent('character-loaded'));
      }

      handDrawing() {
        console.log('handDrawing character');

        if(Polymer.Path.get(this, 'timeline.handDrawing')) {
          this.timeline.handDrawing.seek(0);
          return this.timeline.handDrawing;
        }

        let tl = new TimelineLite({
          autoRemoveChildren: true
        });

        tl
          .add(this.animateContour(), 0)
          .add(this.revealChar(), 3);

        Polymer.Path.set(this, 'timeline.handDrawing', tl);
        return tl;
      }

      handPush() {
        if(Polymer.Path.get(this, 'timeline.handPush')) {
          this.timeline.handPush.seek(0);
          return this.timeline.handPush;
        }

        let tl = new TimelineLite();
        const img = this.shadowRoot.querySelector('picture img');

        tl
          .set(img, {x: "0%", rotation: "0"})
          .to(img, .5, {x: "-400%", rotation: "+=1800"});

        Polymer.Path.set(this, 'timeline.handPush', tl);
        return tl;
      }

      animateContour() {
        let tl = new TimelineLite();
        const contour = this.shadowRoot.getElementById(`${this.page}-contour`);
        const pages = ['speaking', 'writing', 'working'];
        this.selectedPage = pages.indexOf(this.page);
        const contours = contour.querySelectorAll(`#${this.page}-contour path`);

        tl
          .staggerFrom(contours, 3, {drawSVG: "0%",  ease: Power4.easeNone}, 0.3)
          .staggerTo(contours, 0.2, {autoAlpha: 0})
          .staggerTo(contours, 0, {drawSVG: "0%", autoAlpha:"1"});

        Polymer.Path.set(this, 'timeline.animateContour', tl);

        return tl;
      }

      revealChar() {
        let tl = new TimelineLite();
        const img = this.shadowRoot.querySelector('picture img');

        tl
          .set(img, {x: "0%", rotation: "0"})
          .from(img, 1.2, {autoAlpha: 0, ease:Power1.easeIn}, 0);

        Polymer.Path.set(this, 'timeline.revealChar', tl);

        return tl;
      }

    }

    window.customElements.define(MyCharacter.is, MyCharacter);
  </script>
</dom-module>
