<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">

<dom-module id=my-character>
  <template>
    <style>
      :host {
        display: block;
        /*opacity: 0;*/
        position: absolute;
        top: 40px;
        z-index: 2;
        background-color: transparent;
        background-position: 50% 50%;
        background-repeat: no-repeat;
        background-size: contain;
      }

      img {
        width: 100%;
      }

      svg,
      iron-pages{
        position: absolute;
        z-index: 1;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        /*opacity: 0;*/
      }
      picture {
        position: relative;
        z-index: 2;
      }

      :host([page="working"]) {
        left: calc(var(--app-mobile-side-margin) * -1);
      }

      :host([page="writing"]) {
        left: -15px;
      }

      :host([page="speaking"]) {
        left: -15px;
      }

      @media screen and (min-width: 414px) {
        :host([page="working"]) {
          left: -12px;
        }

        :host([page="writing"]) {
          left: 0;
        }

        :host([page="speaking"]) {
          left: 0;
        }
      }

      @media screen and (min-width: 500px) {
        :host {
          top: 20px;
        }

        :host([page="working"]) {
          width: 250px;
        }

        :host([page="writing"]) {
          width: 210px;
        }

        :host([page="speaking"]) {
          width: 180px;
        }
      }

      @media screen and (min-width: 600px) {
        :host([page="working"]) {
          width: 260px;
        }

        :host([page="writing"]) {
          width: 230px;
        }

        :host([page="speaking"]) {
          width: 220px;
        }
      }

      @media screen and (min-width: 768px) {
        :host {
          top: 75px;
        }

        :host([page="working"]),
        :host([page="writing"]),
        :host([page="speaking"]) {
          width: auto;
          /*top: 75px;*/
          left: -58px;
        }
      }

      @media screen and (min-width: 1024px) {
        :host([page="working"]) {
          left: -73px;
        }
      }
    </style>

    <iron-pages selected="[[selectedPage]]">
        <svg id="speaking-contour" viewBox="0 0 1496 1522" xmlns="http://www.w3.org/2000/svg"><g stroke="#000" stroke-width="4" stroke-linecap="round" stroke-linejoin="round" fill="none" fill-rule="evenodd"><path d="M503 1490c4.7-106 10-186 16-240 69-67 149-163 220-239 2.8-3 150.8-3 444 0m-444 10l-18 466M486 264c-.6 21 1 32.6 5 35 3 2 8.4-5.4 16-22 1 14 3 19.3 6 16 7-69 50-78 58-85-12-4-35.2 7.6-37 0-2.2-9 21.3-19.6 29-33 1.8-3-12.7 5.5-13 0-1.7-29.5-3-50 9-70 5-8 12 9.3 25 14 6.4 2.3 7 1 14 0 146 89 168-4 169-23-4 5-6.3 18.6-8 15-2.2-4.6-2.2-15.6 0-33-1.8 8.7-4.2 11.7-7 9-11-47-51-73-62-72-15.2 1.4-17 11-35 9-60-7-75-3-108 8-5.5 1 17.2 5.7 12 7-52-11-68 0-94 15-55 11-68 46-75 65-3.7 2.6-6.4-12.6-6-8-2 85.3 7.7 161 29 227 4-9.6 6.4-13 7-10 3 16.4 4.4 39 4 68 20-6.2 35-15 45-26-1-10 5-21.4-4-19-22 6-34-20-45-36s-20-51-3-63c11.3-8 30.7-6.3 58 5"/><path d="M519 434c37 75 158 82 183 78 16.7-2.7 24.3-11 23-25l3-41c14.7-24.7 22-72.3 22-143 0-21 13.2-19.2 12-36-2.8-38-10.5-75.5-23-112"/><path d="M647 512c-4.7 11.3-11 18.3-19 21l6 5c17.3 68.7-2 104.3-58 107-84 4-100-48-136-74-36-38-62-41-89-57 56-19 77-93 75-109m435 604c69-70 101-127 109-160 1.7-6.8-7-37 0-55-5-4-7-2.5-8-8-1-5 1-20 0-24-3-13-10-22.3-13-31-2-6 3-13.4 10-21 0-23 14-20 21-15 4.7 3.3 8 12.7 10 28 2.4 6.6 5 9.6 8 9 9-2 19.5-5.8 20-9 2-13 19-24 30-37 23-67 28-75 55-107 13.3-15.8 27.8-.8 24 10-11 31-27 51.3-35 92-1.5 7.8 13.4 13.4 19 7 25-29 42-54.2 75-82 19-16 30 4 21 17-25 36-38.7 41.3-70 86-3.7 5.3 0 12.6 4 9 33-30 51.6-51.3 72-66 25-18 33 11 23 23-12.3 14.7-18 15-32 33s-31 29.4-53 54c-2.4 2.7-1.2 8.3 2 8 35-3 43-4 75-9 12.2-2 14 13 4 17-22.3 9-49.7 18.3-82 28-6 8-12 13.7-18 17 0 15-39 45-53 55-21.8 38.2-39.2 82-52 131M24 956c-23 35-26 236 0 232s38.4-10.4 83 0c192 45 319-6 364-25 47.3 7.3 97.7 0 151-22"/><path d="M781 1006c-3.3-6-12.7-7.7-28-5-23 4-77 12-107 29-11.7 6.6-37 3-56 0s-39-22-37-29c21.4-75 1-92-7-100-4-4-17.5-1-17 4 5 54-12 74-17 84s-27 18-36 54c-64.5 20.5-167 32-213 25s-72-31.7-94-38c-14.7-4.2-35.7-6.5-63-7m140-253c6.3 47.5 7.6 89.5 4 126-10 25-16 69.3-25 87-37-29-64-50-97-56-22-4-53.3-.7-94 10m189 45c-14 25.3-26.7 43.7-38 55m165-523c-117.3 52-181 81.3-191 88-15 10-30 30-40 55s-16.2 33.8-27 70c-3 10-16 59-71 193-3.3 11-8 32 12 17m387-588c-39.3 20-38 30 4 30 18 0 35-.7 51-2 3.3 11.3 37.3 18.3 102 21 1.7 9 4 14.4 7 16 4.4 2.4 19 3 23 0s8-20.6 5-24c-3-3.4-19-4.2-26-3-4.6.8-7 3-7 7m55 144c64 44 59 38 92 45s53 19 74 45 64 171 71 206 11 78 19 105c-20 18-51.7 28.3-95 31"/><path d="M821 739c0 82-13 124-19 140s1 52-29 80c-10 9.3-10 13.7 0 13l-2 28m119-59s5 17 10 24m-673 241c-45 69-13 75 2 82-11.3 9.3-17 32.3-17 69l8.5-6-6.5 25 6.5-2c-4.3 16-5.2 25.7-2.5 29 68 33 85 52 118 63 22 7.3 78 12.7 168 16"/></g></svg>
      <svg id="writing-contour" viewBox="0 0 1411 1414" xmlns="http://www.w3.org/2000/svg"><g stroke="#000" stroke-width="4" fill="none" fill-rule="evenodd"><path d="M621 632c9.3-20 18-52.7 26-98-15.3-60-35-104.7-59-134-13.7-32-9-34-26-65-23-50-25-64-49-98-1.8-3-3.8.5-6 10-8-36.7-43-70.3-105-101-3.4-2.8-1 2.8 7 17-68.7-18-117.3-22.7-146-14-17.3 14-32.3 41.7-45 83-1 1.7-2.8.4-5-4 3.3 53.3 22.3 81 57 83 52 3 103-1 154-45 4.5-1.6-1.2-2.2-17-2l49-34c20.7 16.7 45.3 40.3 74 71" stroke-linecap="round" stroke-linejoin="round"/><path d="M210 267c-33.3 30-43 72.3-29 127-20 70 27.4 105.4 59 137 5 5 34 22 82 63 7 0-20-37-46-133-5 1-13 13-16 10-3.3-23.3-5-48.7-5-76-13 6-18.7 5.6-17-1 6.7-26 23.3-49 50-69m-40 217c-13.3 2-18 10-14 24 6 21 47.8 47.3 64 73 12 19 39.6-1 40.8-20 23.5 30 59 59.7 106.2 89m-152-67c-21 3-35.7 7.3-44 13-2.3 1.6 1.7 4.6 12 9-23.3 1.3-40.3 13.3-51 36 90-31.3 142.7 31.7 158 189-10-4-15.3-5.3-16-4 18.7 63.3 20.3 126.7 5 190" stroke-linecap="round" stroke-linejoin="round"/><path d="M212 707c-24.7 28-45 62-61 102-2 5 2.6 6.4 14 4l-20 20c-12.7 44-18 85.3-16 124-54 43-38 144-35 170 110.7-146.7 197-186 259-118m294-438c24.7 4 44.7 12.3 60 25 28-21 58-30 89-25 10.7 1.7 17.3 12 39 17 22-1 55 2 68 8 7.6 3.5 6 15 9 32 42 28.7 70 58.8 84 90.3l11 2.7 93 146c-49.2-23-84-31.7-104-26-9.3 2.7-15.7 10.3-19 23m-617 398l31-16 398 105c114.3-17.8 220.6-36.4 319-56 2-55 54-37 62-20l225-73 11 3c-65.3 30.7-150.3 63-255 97-159.6 27-272 38-372 71-57.3-33.3-197-70.3-419-111z" stroke-linecap="round" stroke-linejoin="round"/><path d="M394 1245c-2-9.3-2-17.3 0-24 136.3-13.3 333-5 421-17 41.7-5.7 102-21 181-46 172 13.3 299 15.3 381 6-73.3 21.3-158.7 51-256 89-130.7-13.3-228-27.7-292-43" stroke-linecap="round" stroke-linejoin="round"/><path d="M412 1227l384 85c134-9.3 234-27.3 300-54m282-93l12 37M536 793c-4 6-7.3 8.7-10 8-29.7-7.4-45.6-14.6-60-29-2-2-1.7-9.3 1-22-14.7-8-18.3-19.3-11-34-4.4-18.4-7-26-6-37 .4-4.7 5.4-10 15-16-4-8-5.4-15.6-4-23 1-4.6 4.6-9 11-13l-49-55-22-35 33 24 53 57c17.3-5.3 31.3-7.7 42-7 17-11 44-18.7 49-13 7 8 67 89 146 145 17 12 241 122 423 215" stroke-linecap="round" stroke-linejoin="round"/><path d="M510 777c5-13 58 24 115 65 9 6.5 36-.2 60 8 38 13 93 60 133 113s66 113 170 195"/><path d="M99 1122c4 37 1 80.2 15 95 35 37 227 93 332 62m654-411c57.3 79.3 95.7 135 115 167 19.3 32 27.3 76.7 24 134m-961-89c115.3-10.7 189-9 221 5 48 21 63 31 138 33 50 1.3 160 9 330 23M493 812c53.3 59.3 100.3 132.3 141 219M470 833c26.7 54.7 43.3 125.7 50 213" stroke-linecap="round" stroke-linejoin="round"/></g></svg>
        <svg id="working-contour" viewBox="0 0 1519 1386" xmlns="http://www.w3.org/2000/svg"><g stroke="#000" stroke-width="4" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><path d="M417.4 544c33.3 52.6 60 84.4 79.6 95.4 29.5 16.4 42.8 19.3 75.8 28.5 14 3 42.4-8 54.7-17 5.5-4 27.3-69 44.4-113 3-9-3-89 0-144 0-11 9-14 9-30 0-48-43-237-211-203-142 31-164 170-144 235-10 20-4 37 2 55 3 12 11 20 23 26-1 7 0 13 1 18s3 9 7 13l6 77c2 24 5 41 10 50 48 91 119 117 191 86m296 571c-38-15-142-86-310-211l123-41M323 317c145.3-85 272-93 324.7-53.3m33.5 107.5c-47.5-27-320 13-341 27.8"/><path d="M332.4 409.8c60.7-5.3 113.7 14.7 154 39.8 17 10.5 56 66.3 138.6 12l4 11.6c23 1.4 37.3 1.4 43.2.3m-184.8-24s10.5-52 35-81.4M666 576c47.3 12 51.3 23.6 82.5 59 7.5 8.6 16.5 4.6 23.2 13 6.8 8.5 5 20.4 10.5 28.2 5.6 7.7 8.3 2.2 15.8 8.6 7.6 6.4 1.7 19 7.6 28.4 5.8 9.5 38 11.7 36.2 36 14 19.7 28.4 47.3 43.4 82.5m-639.7-485c-75.3 57.3-137.3 117-186 179 9.7 20 67.5 84.2 107.2 114"/><path d="M177.7 627L76.5 525.7c65.3-71.3 126-128.5 181.7-171.5 4-3 25 19.7 63.2 67.8m353 109.5c2-5.6 5.5-8.5 10-9L711 493c2.4 1.5 4 1 5 0-5.5-65.8 44-70 72.7-89.8-20.3 44 8.6 86.7-64.8 97-1 1.7-1 3.6 0 6l-24 31.2c-1 13.4-7 27-21 41m-313 10.2c-75 5.2-120 15-136 30-49 1.2-63 19.5-72 32.3-30 7-53 24-70 51 11 0 17 1 17 2-17 12-24 43-21 93-4 17-6 29-5 35 1 9 5 11 10 21 6 131 12 82 31 99 6 46 5 58 26 72 2 5 4 11 7 16 4-3 6-3 7-1 24 37 34 76 41 120 16 55 100 75 149 73 49-3 159-71 228-133"/><path d="M297.6 1056.3c47.8-38.3 92.2-36.2 135-50 169.4-54 197.7-94.3 260.4-111 62.8-16.5 78.2-24 105.2-25.2 18-1 46 9 84 29l-.3 44m-266 113l22-27m-297-56l20 50m247-4c54 21 85 22 92 25 7 4 41 57 79 94 15 15 42-8 30-24-27-34-40-50-69-89-5-6 6-17 12-13 44 37 53 50 108 93"/><path d="M875.4 1293c124-63.2 489.6-209.6 518.7-232.2 16-12 30-408 40-438.2 8-23.8-296 78-401 92.4-105 14.2-150 18.4-149 28 9 60.5-17 495.4-23 517-6 21.7 6 37.6 15 33zm-688-625.5c40.2 9.8 70 49 89.4 117.6 3.4 12-10.4 11-7.4 18 6.5 6 22 23 29.4 39 5 11-8.5 8-8.5 17s2.7 18 8.2 26c22 6 34.4 14 37.4 26s-3 23-16 32c14 14 22 24 24 31-69-4-128 16-177 59m504-296c34 41 51 91 52 152 10-3 26-7 42-11 29-54 58-85 86-94"/></g></svg>
    </iron-pages>

    <picture>
      <source media="(max-width: 599px)"
              srcset="/images/[[page]]-mobile.png,
                        /images/[[page]]-mobile@2x.png 1.5x,
                        /images/[[page]]-mobile@2x.png 2x">
      <source media="(max-width: 1023px)"
              srcset="/images/[[page]]-tablet.png,
                        /images/[[page]]-tablet@2x.png 1.5x,
                        /images/[[page]]-tablet@2x.png 2x">
      <source srcset="/images/[[page]].png,
                        /images/[[page]]@2x.png 1.5x,
                        /images/[[page]]@2x.png 2x">
      <img src="/images/[[page]].png" alt="">
    </picture>
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class MyCharacter extends Polymer.Element {
      static get is() {
        return 'my-character';
      }

      static get properties() {
        return {
          page: {
            type: String,
            reflectToAttribute: true,
            observer: 'animateCharacter'
          },
          timeline: Object,
          selectedPage: Number
        };
      }

      _onEntryAnimationComplete() {
        Polymer.RenderStatus.afterNextRender(this, () => {
          const contour = this.shadowRoot.getElementById(`${this.page}-contour`);
          const img = this.shadowRoot.querySelector('picture img');
          contour.setAttribute('data-used', true);
          img.style.removeProperty('opacity');
        });
      }

      animateCharacter(newPage, oldPage) {
        const contour = this.shadowRoot.getElementById(`${this.page}-contour`);
        if (!contour.getAttribute('data-used')) {
          Polymer.RenderStatus.afterNextRender(this, () => {
            const contour = this.shadowRoot.getElementById(`${this.page}-contour`);
            const img = this.shadowRoot.querySelector('picture img');
            const swap = () => { this._onEntryAnimationComplete(); };

              const pages = ['speaking', 'writing', 'working'];
              this.selectedPage = pages.indexOf(this.page);

              const contours = contour.querySelectorAll(`#${this.page}-contour path`);
              let tl = new TimelineLite({
                paused: true,
                onComplete: swap,
                autoRemoveChildren: true
              });

              tl.staggerFrom(contours, 2, {drawSVG: "0%",  ease: Power2.easeIn}, 0.3)
                .from(img, .5, {opacity: 0})
                .staggerTo(contours, .2, {opacity: 0}, "-=.3");

              contour.style.setProperty('opacity', 1);
              tl.play();
          });
        }
      }
    }

    window.customElements.define(MyCharacter.is, MyCharacter);
  </script>
</dom-module>
